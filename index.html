
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>送你最美的烟花</title>
    <style>
        * {
            margin: 0px;
            padding: 0px;
        }
        body {
            width: 100vw;
            overflow-x: hidden;
        }
    </style>
</head>
<body>

    <canvas></canvas>

    <script>


            let canvas = document.getElementsByTagName("canvas")[0]
            let ctx = canvas.getContext("2d");

            function resizeCanvas() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            }

            // function clearCanvas(){
            //     ctx.fillStyle = '#ffffff';
            //     ctx.fillRect(0, 0, canvas.width, canvas.height);
            // }

            window.addEventListener('resize', resizeCanvas, false);
            resizeCanvas();

            function randomFireLocation() {
                let y = window.innerHeight;
                let x = Math.random() * window.innerWidth;

                return { x, y }
            }



            let clear = setInterval(clean, 13 * 1.2);
            
            function fireUp() {
                let fire_location = randomFireLocation()
                create_fire(fire_location)
            }

            function create_fire(x, y, color) {
                let oldColor = ctx.fillStyle;
                ctx.fillStyle = color ? color :"lime";
                ctx.beginPath();
                ctx.arc(x, y, 3, 0, 2 * Math.PI, false);
                ctx.fill();
                ctx.fillStyle = oldColor;
            }

            function fly() {
                const curh = Math.floor((Math.random() * 500) + 100);
                const randomNum = Math.floor((Math.random() * 6) + 3);
                let yh = window.innerHeight;
                let x = Math.floor(Math.random() * window.innerWidth);
                let list = []
                clearInterval(timer)
                let rgba = `rgba(${Math.random() * 255}, ${Math.random() * 255}, ${Math.random() * 255}, ${Math.random() * 255})`
                var timer = setInterval(() => {

                    if (yh <= curh) {
                        clearInterval(timer)
                        func(x, yh, rgba)
                        navigator.vibrate(1000);
                        setTimeout(() => {
                            navigator.vibrate(0);
                        }, 300)

                    }

                    yh -= randomNum
                    
                    // console.log(yh, x)
                    
                    create_fire(x, yh, rgba)
                }, 13)
            }

            function func(x, y, rgba) {
                let list = create_fireWork(x, y)
                // console.log(list)
                let timer = null
                clearInterval(timer)
                timer = setInterval(() => {
                    if (list.length <= 0) {
                        clearInterval(timer);
                        // max++;
                        return;
                    }
                    let p = list.shift();
                    p.forEach(n => {
                        create_fire(n.x, n.y, rgba);
                        
                    })
                }, 13)
            }

            function clean() {
                let max = 50000;
                // let defaultFillStyle = ctx.fillStyle;
                ctx.fillStyle = '#0002'
                // ctx.beginPath();
                ctx.fillRect(-max, -max, 2 * max, 2 * max);
                // ctx.fillStyle = 'blue';
            }

            for(let i = 0; i < 20; i++) {
            fly()

            }

            function create_fireWork(sx, sy) {
                const MaxR = (Math.random() * 40) + 20; // 最大半径
                const total = 360;
                const list = [];
                const list2 = [];

                step = Math.floor(Math.random() * 5) + 10;
                for (let i = step; i <= 360; i+= step) {
                    let angle = 360 / total * i;
                    let h = angle * Math.PI / 180;
                    
                    let x = Math.cos(h).toFixed(4);
                    let y = Math.sin(h).toFixed(4);

                    list.push({x, y, r: 2})
                }

                let randomR = list.map(n => Number(Math.random() * 0.4 + 0.8).toFixed(2)).map(n => n ** 3)
                for (let i = 1; i < MaxR; i++) {
                    let j = 0;
                    list2.push(
                        list.map(item => ({
                            x: item.x * i * 1.8 + sx,
                            y: item.y * i * 1.5 + sy+ parseInt(randomR[j++]) * (i ** 1.05),
                            r: item.r,
                            color: `rgba(${Math.random() * 255}, ${Math.random() * 255}, ${Math.random() * 90}, ${Math.random() * 10})`
                        }))
                    )
                }

                return list2
            }


            document.onclick = function() {
                fly()
            }

            // create_fireWork()

            // fireUp()
    </script>
</body>
</html>